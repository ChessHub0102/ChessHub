{% extends 'base.html' %}
{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8">
  <div class="flex flex-wrap justify-between items-center mb-6 sm:mb-8">
    <h1 class="text-2xl sm:text-3xl font-bold text-chess-primary w-full sm:w-auto mb-4 sm:mb-0">Admin Panel</h1>
    <div class="flex w-full sm:w-auto">
      <a href="{{ url_for('logout') }}" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors w-full sm:w-auto text-center">Logout</a>
    </div>
  </div>
  
  <!-- Analytics Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6 sm:mb-8">
    <div class="bg-white rounded-lg shadow p-4 sm:p-6">
      <h2 class="text-lg font-semibold text-chess-primary mb-2">Total Visits</h2>
      <p class="text-2xl sm:text-3xl font-bold">{{ total_visitors }}</p>
      <p class="text-sm text-gray-500">All page visits</p>
      <a href="{{ url_for('admin_visitor_logs') }}" class="text-sm text-chess-accent hover:underline mt-2 inline-block">View Visitor Logs</a>
    </div>
    
    <div class="bg-white rounded-lg shadow p-4 sm:p-6">
      <h2 class="text-lg font-semibold text-chess-primary mb-2">Today's Visits</h2>
      <p class="text-2xl sm:text-3xl font-bold">{{ visitors_today }}</p>
      <p class="text-sm text-gray-500">Page visits today</p>
    </div>
    
    <div class="bg-white rounded-lg shadow p-4 sm:p-6">
      <h2 class="text-lg font-semibold text-chess-primary mb-2">Unique Visitors</h2>
      <p class="text-2xl sm:text-3xl font-bold">{{ unique_visitors }}</p>
      <p class="text-sm text-gray-500">Distinct visitors by IP</p>
    </div>
    
    <div class="bg-white rounded-lg shadow p-4 sm:p-6">
      <h2 class="text-lg font-semibold text-chess-primary mb-2">Unique Today</h2>
      <p class="text-2xl sm:text-3xl font-bold">{{ unique_visitors_today }}</p>
      <p class="text-sm text-gray-500">Unique visitors today</p>
    </div>
  </div>
  
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 sm:mb-8">
    <div class="bg-white rounded-lg shadow p-4 sm:p-6">
      <h2 class="text-lg font-semibold text-chess-primary mb-2">IP Records</h2>
      <p class="text-2xl sm:text-3xl font-bold">{{ ip_json_count }}</p>
      <a href="{{ url_for('admin_ip_json') }}" class="text-sm text-chess-accent hover:underline mt-2 inline-block">View IP JSON Data</a>
    </div>
  </div>
  
  <!-- Quick Links -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8">
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="bg-chess-primary py-3 px-4">
        <h2 class="text-lg font-semibold text-white">Administration</h2>
      </div>
      <div class="p-4 space-y-3">
        <a href="{{ url_for('admin_visitor_logs') }}" class="block bg-gray-100 hover:bg-gray-200 p-3 rounded-lg transition-colors">
          <div class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-chess-primary mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
            <span class="font-medium">Visitor Logs</span>
          </div>
        </a>
        
        <a href="{{ url_for('admin_ip_json') }}" class="block bg-gray-100 hover:bg-gray-200 p-3 rounded-lg transition-colors">
          <div class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-chess-primary mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" />
            </svg>
            <span class="font-medium">IP JSON Database</span>
          </div>
        </a>
      </div>
    </div>
    
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="bg-chess-primary py-3 px-4">
        <h2 class="text-lg font-semibold text-white">Tournament Management</h2>
      </div>
      <div class="p-4 space-y-3">
        <a href="{{ url_for('home') }}" class="block bg-gray-100 hover:bg-gray-200 p-3 rounded-lg transition-colors">
          <div class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-chess-primary mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            <span class="font-medium">Homepage</span>
          </div>
        </a>
        
        <a href="{{ url_for('create_tournament') }}" class="block bg-gray-100 hover:bg-gray-200 p-3 rounded-lg transition-colors">
          <div class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-chess-primary mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="font-medium">Create Tournament</span>
          </div>
        </a>
      </div>
    </div>
  </div>
  
  <div class="bg-white rounded-lg shadow overflow-hidden mb-6 sm:mb-8">
    <div class="bg-chess-primary py-3 px-4">
      <h2 class="text-lg font-semibold text-white">Tournaments</h2>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
            <th scope="col" class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Organizer</th>
            <th scope="col" class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell">State</th>
            <th scope="col" class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell">Date</th>
            <th scope="col" class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for tournament in tournaments %}
          <tr class="{% if loop.index % 2 == 0 %}bg-gray-50{% else %}bg-white{% endif %} hover:bg-gray-100">
            <td class="px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-medium text-gray-900">{{ tournament.title }}</td>
            <td class="px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500">
              {% for organizer in organizers %}
                {% if organizer._id|string == tournament.organizer_id|string %}
                  {{ organizer.name }}
                {% endif %}
              {% endfor %}
            </td>
            <td class="px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 hidden md:table-cell">{{ tournament.state }}</td>
            <td class="px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 hidden sm:table-cell">
              {% if tournament.dates|length > 0 %}
                {{ tournament.dates[0]|datetimeformat }}
              {% endif %}
            </td>
            <td class="px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-medium">
              <a href="{{ url_for('tournament_detail', tournament_id=tournament._id) }}" class="text-chess-primary hover:text-chess-accent">View</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <div class="bg-chess-primary py-3 px-4">
      <h2 class="text-lg font-semibold text-white">Organizers</h2>
    </div>
    
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
            <th scope="col" class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell">Name</th>
            <th scope="col" class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell">Type</th>
            <th scope="col" class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell">Location</th>
            <th scope="col" class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
            <th scope="col" class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Admin</th>
          </tr>
        </thead>
        <tbody>
          {% for organizer in organizers %}
          <tr class="{% if loop.index % 2 == 0 %}bg-gray-50{% else %}bg-white{% endif %} hover:bg-gray-100">
            <td class="px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-medium text-gray-900">{{ organizer.username }}</td>
            <td class="px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 hidden sm:table-cell">{{ organizer.name }}</td>
            <td class="px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 hidden md:table-cell">{{ organizer.type }}</td>
            <td class="px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 hidden lg:table-cell">{{ organizer.location }}</td>
            <td class="px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500">
              {% if organizer.contact and organizer.contact.get('whatsapp') %}
              <a href="https://wa.me/91{{ organizer.contact['whatsapp'] }}" target="_blank" class="text-chess-primary hover:text-chess-accent">
                +91 {{ organizer.contact['whatsapp'] }}
              </a>
              {% endif %}
            </td>
            <td class="px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500">
              {% if organizer.is_admin %}
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Yes</span>
              {% else %}
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">No</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}